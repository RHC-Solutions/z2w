<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Z2W{% endblock %}</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      /* Dark mode tokens */
      --background:  oklch(0.13 0.008 265);
      --foreground:  oklch(0.93 0.005 265);
      --card:        oklch(0.17 0.008 265);
      --card-hover:  oklch(0.20 0.008 265);
      --border:      oklch(0.28 0.008 265);
      --input:       oklch(0.28 0.008 265);
      --muted:       oklch(0.21 0.008 265);
      --muted-foreground: oklch(0.58 0.012 265);
      --accent:      oklch(0.22 0.010 265);

      --primary:     oklch(0.65 0.15 221.7);
      --primary-foreground: oklch(0.98 0.002 247);
      --secondary:   oklch(0.22 0.008 265);
      --secondary-foreground: oklch(0.85 0.006 265);

      --destructive: oklch(0.62 0.24 27);
      --destructive-foreground: oklch(0.98 0 0);
      --success:     oklch(0.64 0.15 162);
      --warning:     oklch(0.78 0.18 70);

      --ring:        oklch(0.65 0.15 221.7);
      --radius:      0.3rem;

      /* Sidebar — slightly lighter than page */
      --sidebar:                oklch(0.165 0.010 240);
      --sidebar-foreground:     oklch(0.88 0.006 265);
      --sidebar-border:         oklch(0.25 0.008 265);
      --sidebar-primary:        oklch(0.65 0.15 221.7);
      --sidebar-primary-fg:     oklch(0.98 0.002 247);
      --sidebar-accent:         oklch(0.22 0.012 240);
      --sidebar-accent-fg:      oklch(0.93 0.005 265);
      --sidebar-muted:          oklch(0.50 0.012 265);
    }

    html, body {
      height: 100%;
      font-family: 'Figtree', ui-sans-serif, system-ui, sans-serif;
      font-size: 15px;
      background: var(--background);
      color: var(--foreground);
      -webkit-font-smoothing: antialiased;
    }
    .app-shell { display: flex; height: 100vh; overflow: hidden; }

    /* ── Sidebar ───────────────────────────────────────────── */
    .sidebar {
      width: 228px; min-width: 228px;
      display: flex; flex-direction: column;
      background: var(--sidebar);
      border-right: 1px solid var(--sidebar-border);
      transition: width 0.18s, min-width 0.18s;
      overflow: hidden;
    }
    .sidebar.collapsed { width: 54px; min-width: 54px; }

    .sidebar-header {
      display: flex; align-items: center; gap: 0;
      padding: 13px 12px;
      border-bottom: 1px solid var(--sidebar-border);
      min-height: 54px;
    }
    .sidebar-logo { width: 28px; height: 28px; border-radius: 6px; flex-shrink: 0; }
    .sidebar-title { font-size: 14px; font-weight: 700; color: var(--sidebar-foreground); white-space: nowrap; overflow: hidden; line-height: 1.1; }
    .sidebar-subtitle { font-size: 11.5px; color: var(--sidebar-muted); white-space: nowrap; overflow: hidden; line-height: 1.1; }

    .sidebar-user {
      padding: 8px 13px; font-size: 12px; color: var(--sidebar-muted);
      display: flex; align-items: center; gap: 7px;
      border-bottom: 1px solid var(--sidebar-border); overflow: hidden;
    }
    .sidebar-user span { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .sidebar-nav { flex: 1; padding: 8px 6px; overflow-y: auto; }

    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 8px 10px; border-radius: var(--radius);
      font-size: 14px; font-weight: 500;
      color: var(--sidebar-foreground);
      text-decoration: none;
      transition: background 0.12s, color 0.12s;
      white-space: nowrap; overflow: hidden; cursor: pointer;
    }
    .nav-item svg { width: 16px; height: 16px; flex-shrink: 0; opacity: 0.75; }
    .nav-item span { overflow: hidden; text-overflow: ellipsis; }
    .nav-item:hover { background: var(--sidebar-accent); color: var(--sidebar-accent-fg); }
    .nav-item:hover svg { opacity: 1; }
    .nav-item.active {
      background: color-mix(in oklch, var(--sidebar-primary) 18%, transparent);
      color: var(--sidebar-primary);
      font-weight: 600;
    }
    .nav-item.active svg { opacity: 1; color: var(--sidebar-primary); }
    .nav-item.active:hover { background: color-mix(in oklch, var(--sidebar-primary) 22%, transparent); }

    .nav-section {
      padding: 10px 10px 3px; font-size: 10.5px; font-weight: 600;
      letter-spacing: 0.08em; text-transform: uppercase;
      color: var(--sidebar-muted); white-space: nowrap; overflow: hidden;
    }
    .nav-divider { height: 1px; background: var(--sidebar-border); margin: 5px 0; }

    .sidebar-footer { padding: 6px 6px; border-top: 1px solid var(--sidebar-border); }
    .collapse-btn {
      display: flex; align-items: center; justify-content: center; gap: 6px;
      width: 100%; padding: 7px 10px; border: none; background: transparent;
      border-radius: var(--radius); font-size: 12.5px; font-weight: 500;
      color: var(--sidebar-muted); cursor: pointer;
      transition: background 0.12s; white-space: nowrap; font-family: inherit;
    }
    .collapse-btn:hover { background: var(--sidebar-accent); color: var(--sidebar-accent-fg); }

    /* Hide labels when collapsed */
    .sidebar.collapsed .sidebar-title,
    .sidebar.collapsed .sidebar-subtitle,
    .sidebar.collapsed .sidebar-user,
    .sidebar.collapsed .nav-item span,
    .sidebar.collapsed .nav-section,
    .sidebar.collapsed .collapse-label { display: none; }
    .sidebar.collapsed .nav-item { justify-content: center; padding: 8px 0; }
    .sidebar.collapsed .sidebar-header { justify-content: center; }
    .sidebar.collapsed .collapse-btn { justify-content: center; }

    /* ── Main area ─────────────────────────────────────────── */
    .topbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 22px; min-height: 54px;
      border-bottom: 1px solid var(--border);
      background: var(--card); flex-shrink: 0; gap: 12px;
    }
    .topbar-left .topbar-title { font-size: 16px; font-weight: 700; }
    .topbar-left .topbar-sub { font-size: 12.5px; color: var(--muted-foreground); margin-top: 1px; }
    .topbar-actions { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .page-content { flex: 1; overflow-y: auto; padding: 22px 26px; }

    /* Explorer frame */
    .frame-mode { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .explorer-frame { flex: 1; width: 100%; border: none; }

    /* ── Cards ─────────────────────────────────────────────── */
    .card { background: var(--card); border: 1px solid var(--border); border-radius: calc(var(--radius)*1.5); overflow: hidden; }
    .card-header { padding: 14px 18px 11px; border-bottom: 1px solid var(--border); }
    .card-title { font-size: 14.5px; font-weight: 600; }
    .card-desc { font-size: 12.5px; color: var(--muted-foreground); margin-top: 2px; }
    .card-body { padding: 18px; }

    /* ── Stat grid ─────────────────────────────────────────── */
    .stat-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(175px, 1fr)); gap: 14px; }
    .stat-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: calc(var(--radius)*1.5); padding: 16px 18px;
      transition: background 0.12s;
    }
    .stat-card:hover { background: var(--card-hover); }
    .stat-label {
      font-size: 11.5px; font-weight: 500; color: var(--muted-foreground);
      margin-bottom: 5px; display: flex; align-items: center; gap: 5px;
    }
    .stat-label svg { width: 13px; height: 13px; }
    .stat-value { font-size: 24px; font-weight: 700; }
    .stat-sub { font-size: 11.5px; color: var(--muted-foreground); margin-top: 3px; }
    .stat-card.primary .stat-value { color: var(--primary); }
    .stat-card.success .stat-value { color: var(--success); }
    .stat-card.danger  .stat-value { color: var(--destructive); }
    .stat-card.warning .stat-value { color: var(--warning); }

    /* ── Buttons ───────────────────────────────────────────── */
    .btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 7px 14px; border-radius: var(--radius);
      font-size: 13.5px; font-weight: 500; cursor: pointer;
      border: 1px solid transparent;
      transition: background 0.12s, opacity 0.12s;
      text-decoration: none; font-family: inherit; white-space: nowrap; line-height: 1.4;
    }
    .btn:disabled { opacity: 0.45; cursor: not-allowed; }
    .btn svg { width: 14px; height: 14px; flex-shrink: 0; }
    .btn-primary    { background: var(--primary); color: var(--primary-foreground); border-color: var(--primary); }
    .btn-primary:hover { background: oklch(0.60 0.15 221.7); border-color: oklch(0.60 0.15 221.7); }
    .btn-secondary  { background: var(--secondary); color: var(--secondary-foreground); border-color: var(--border); }
    .btn-secondary:hover { background: oklch(0.26 0.008 265); }
    .btn-destructive { background: var(--destructive); color: var(--destructive-foreground); border-color: var(--destructive); }
    .btn-destructive:hover { background: oklch(0.56 0.24 27); }
    .btn-outline { background: transparent; color: var(--foreground); border-color: var(--border); }
    .btn-outline:hover { background: var(--accent); }
    .btn-ghost { background: transparent; color: var(--muted-foreground); border-color: transparent; }
    .btn-ghost:hover { background: var(--accent); color: var(--foreground); }
    .btn-warning { background: var(--warning); color: #000; border-color: var(--warning); }
    .btn-warning:hover { background: oklch(0.71 0.18 70); }
    .btn-success { background: var(--success); color: #fff; border-color: var(--success); }
    .btn-success:hover { background: oklch(0.57 0.15 162); }
    .btn-info { background: var(--primary); color: var(--primary-foreground); border-color: var(--primary); }
    .btn-sm { padding: 5px 11px; font-size: 12.5px; }
    .btn-xs { padding: 3px 8px; font-size: 11.5px; }

    /* ── Badges ────────────────────────────────────────────── */
    .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 999px; font-size: 11.5px; font-weight: 500; }
    .badge-primary   { background: color-mix(in oklch, var(--primary) 20%, transparent); color: oklch(0.78 0.12 221.7); }
    .badge-success   { background: color-mix(in oklch, var(--success) 20%, transparent); color: oklch(0.78 0.14 162); }
    .badge-warning   { background: color-mix(in oklch, var(--warning) 20%, transparent); color: oklch(0.86 0.16 70); }
    .badge-danger    { background: color-mix(in oklch, var(--destructive) 20%, transparent); color: oklch(0.78 0.22 27); }
    .badge-secondary { background: var(--muted); color: var(--muted-foreground); border: 1px solid var(--border); }
    .badge-muted     { background: var(--muted); color: var(--muted-foreground); }

    /* ── Tables ────────────────────────────────────────────── */
    .table-wrap { border: 1px solid var(--border); border-radius: calc(var(--radius)*1.5); overflow: hidden; }
    table { width: 100%; border-collapse: collapse; }
    thead tr { border-bottom: 1px solid var(--border); }
    th {
      padding: 9px 13px; text-align: left;
      font-size: 12px; font-weight: 600;
      color: var(--muted-foreground);
      background: oklch(0.15 0.008 265);
      white-space: nowrap;
    }
    th a { color: inherit; text-decoration: none; }
    th a:hover { color: var(--foreground); }
    th.sortable { cursor: pointer; user-select: none; }
    th.sortable:hover { color: var(--foreground); background: oklch(0.18 0.008 265); }
    th .sort-icon { opacity: 0.45; font-size: 11px; margin-left: 2px; }
    td { padding: 9px 13px; font-size: 13.5px; border-bottom: 1px solid var(--border); vertical-align: middle; }
    tbody tr:last-child td { border-bottom: none; }
    tbody tr:hover { background: color-mix(in oklch, var(--muted) 55%, transparent); }

    /* ── Forms ─────────────────────────────────────────────── */
    .form-label { display: block; font-size: 13.5px; font-weight: 500; margin-bottom: 5px; }
    .form-control, .form-select {
      width: 100%; padding: 8px 11px;
      border: 1px solid var(--input); border-radius: var(--radius);
      font-size: 13.5px; font-family: inherit;
      background: oklch(0.15 0.006 265);
      color: var(--foreground); outline: none;
      transition: border-color 0.12s, box-shadow 0.12s;
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px color-mix(in oklch, var(--primary) 22%, transparent);
    }
    .form-control::placeholder { color: var(--muted-foreground); }
    .form-group { margin-bottom: 16px; }
    .form-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

    /* ── Alerts ────────────────────────────────────────────── */
    .alert { padding: 11px 15px; border-radius: var(--radius); font-size: 13.5px; border: 1px solid transparent; margin-bottom: 14px; display: flex; align-items: flex-start; gap: 9px; }
    .alert svg { flex-shrink: 0; margin-top: 1px; }
    .alert-success { background: color-mix(in oklch, var(--success) 12%, transparent); border-color: color-mix(in oklch, var(--success) 28%, transparent); color: oklch(0.78 0.14 162); }
    .alert-danger  { background: color-mix(in oklch, var(--destructive) 12%, transparent); border-color: color-mix(in oklch, var(--destructive) 25%, transparent); color: oklch(0.78 0.22 27); }
    .alert-warning { background: color-mix(in oklch, var(--warning) 12%, transparent); border-color: color-mix(in oklch, var(--warning) 25%, transparent); color: oklch(0.86 0.16 70); }
    .alert-info    { background: color-mix(in oklch, var(--primary) 12%, transparent); border-color: color-mix(in oklch, var(--primary) 25%, transparent); color: oklch(0.78 0.12 221.7); }

    /* ── Tabs ──────────────────────────────────────────────── */
    .tabs { display: flex; gap: 0; border-bottom: 1px solid var(--border); margin-bottom: 18px; }
    .tab-btn {
      padding: 8px 16px; font-size: 13.5px; font-weight: 500;
      border: none; background: transparent; color: var(--muted-foreground);
      cursor: pointer; border-bottom: 2px solid transparent;
      transition: color 0.12s, border-color 0.12s; font-family: inherit;
    }
    .tab-btn:hover { color: var(--foreground); }
    .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; }

    /* ── Pagination ────────────────────────────────────────── */
    .pagination { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 18px; }
    .page-link {
      padding: 6px 11px; border-radius: var(--radius); font-size: 13.5px;
      text-decoration: none; color: var(--foreground);
      border: 1px solid var(--border); transition: background 0.12s;
    }
    .page-link:hover { background: var(--accent); }
    .page-link.active { background: var(--primary); color: var(--primary-foreground); border-color: var(--primary); }
    .page-link.disabled { opacity: 0.35; pointer-events: none; }

    /* ── Modal ─────────────────────────────────────────────── */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
    .modal-overlay.open { display: flex; }
    .modal-box {
      background: var(--card); border: 1px solid var(--border);
      border-radius: calc(var(--radius)*2); padding: 26px;
      width: 440px; max-width: 95vw;
      box-shadow: 0 24px 80px rgba(0,0,0,0.5);
    }
    .modal-title { font-size: 17px; font-weight: 700; margin-bottom: 9px; }
    .modal-body { font-size: 13.5px; color: var(--muted-foreground); margin-bottom: 22px; line-height: 1.65; }
    .modal-footer { display: flex; gap: 8px; justify-content: flex-end; }

    /* ── Toast ─────────────────────────────────────────────── */
    #toastContainer { position: fixed; bottom: 22px; right: 22px; z-index: 9999; display: flex; flex-direction: column; gap: 9px; }
    .toast {
      padding: 12px 18px; border-radius: var(--radius);
      font-size: 13.5px; font-weight: 500; color: #fff;
      min-width: 290px; max-width: 420px;
      display: flex; align-items: center; gap: 11px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.4);
      animation: slideUp 0.2s ease;
    }
    .toast-close { margin-left: auto; cursor: pointer; background: none; border: none; color: inherit; font-size: 18px; line-height: 1; }
    @keyframes slideUp { from { transform: translateY(12px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* ── Section headings ──────────────────────────────────── */
    .section-heading {
      font-size: 11.5px; font-weight: 600; color: var(--muted-foreground);
      text-transform: uppercase; letter-spacing: 0.07em;
      margin-bottom: 13px; padding-bottom: 7px; border-bottom: 1px solid var(--border);
    }
    .page-header { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; margin-bottom: 22px; }
    .page-title { font-size: 22px; font-weight: 700; }
    .page-sub { font-size: 13px; color: var(--muted-foreground); margin-top: 2px; }

    /* ── Spinner ───────────────────────────────────────────── */
    .spinner {
      width: 15px; height: 15px; border: 2px solid currentColor; border-top-color: transparent;
      border-radius: 50%; animation: spin 0.6s linear infinite;
      display: inline-block; vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ── Utilities ─────────────────────────────────────────── */
    .flex { display: flex; } .items-center { align-items: center; } .justify-between { justify-content: space-between; }
    .gap-2 { gap: 8px; } .gap-3 { gap: 12px; } .gap-4 { gap: 16px; } .flex-wrap { flex-wrap: wrap; }
    .mt-1{margin-top:4px}.mt-2{margin-top:8px}.mt-3{margin-top:12px}.mt-4{margin-top:16px}.mt-6{margin-top:24px}
    .mb-1{margin-bottom:4px}.mb-2{margin-bottom:8px}.mb-3{margin-bottom:12px}.mb-4{margin-bottom:16px}
    .text-sm{font-size:13px}.text-xs{font-size:12px}
    .text-muted{color:var(--muted-foreground)}.text-primary{color:var(--primary)}
    .text-destructive{color:var(--destructive)}.text-success{color:var(--success)}.text-center{text-align:center}
    .font-mono{font-family:ui-monospace,monospace;font-size:12.5px}.font-semibold{font-weight:600}
    .truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.w-full{width:100%}.hidden{display:none!important}
    @media(max-width:768px){.form-row-2,.form-row-3{grid-template-columns:1fr}}

    /* ── Scrollbar (dark) ──────────────────────────────────── */
    ::-webkit-scrollbar { width: 7px; height: 7px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: oklch(0.30 0.008 265); border-radius: 999px; }
    ::-webkit-scrollbar-thumb:hover { background: oklch(0.38 0.008 265); }

    /* ── Page footer ───────────────────────────────────────── */
    .main-area { flex: 1; min-width: 0; display: flex; flex-direction: column; overflow: hidden; }
    .app-footer {
      flex-shrink: 0;
      border-top: 1px solid var(--border);
      background: var(--card);
      padding: 9px 26px;
      display: flex; align-items: center; justify-content: center; flex-wrap: wrap;
      gap: 4px 10px;
      font-size: 11.5px; color: var(--muted-foreground);
    }
    .app-footer a { color: var(--muted-foreground); text-decoration: none; }
    .app-footer a:hover { color: var(--foreground); text-decoration: underline; }
    .app-footer .sep { opacity: 0.4; }

    /* ── Tenant tree nav ───────────────────────────────────── */
    .nav-tenant-group { }
    .nav-tenant-header {
      display: flex; align-items: center; gap: 6px;
      padding: 5px 10px; border-radius: var(--radius);
      cursor: pointer; user-select: none;
      transition: background 0.12s;
    }
    .nav-tenant-header:hover { background: var(--sidebar-accent); }
    .nav-tenant-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: oklch(0.42 0.008 265); flex-shrink: 0;
    }
    .dot-active { background: oklch(0.65 0.17 145); }
    .nav-tenant-icon { flex-shrink: 0; color: var(--primary); }
    .nav-tenant-icon svg { display: block; }
    .nav-tenant-name {
      flex: 1; font-size: 13px; font-weight: 650;
      color: var(--sidebar-foreground); overflow: hidden;
      text-overflow: ellipsis; white-space: nowrap;
    }
    .nav-tenant-chevron {
      color: var(--sidebar-muted); flex-shrink: 0;
      transition: transform 0.2s ease;
    }
    .nav-tenant-group.expanded .nav-tenant-chevron { transform: rotate(180deg); }
    .nav-tenant-children { display: none; padding-bottom: 2px; }
    .nav-tenant-group.expanded .nav-tenant-children { display: block; }
    .nav-sub {
      padding-left: 22px !important;
      font-size: 12.5px !important;
    }
    .sidebar.collapsed .nav-tenant-header { justify-content: center; padding: 8px 0; }
    .sidebar.collapsed .nav-tenant-name,
    .sidebar.collapsed .nav-tenant-chevron { display: none; }
    .sidebar.collapsed .nav-tenant-children { display: none !important; }
  </style>
</head>
<body>
<div class="app-shell" id="appShell">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="/" style="display:flex;align-items:center;gap:0;text-decoration:none;min-width:0;flex:1;" title="Go to home">
        <img src="{{ url_for('static', filename='logo.svg') }}" alt="z2w" class="sidebar-logo">
        <div style="min-width:0;line-height:1.2;margin-left:3px;">
          <div class="sidebar-title">Z2W</div>
          <div class="sidebar-subtitle"><a href="https://rhcsolutions.com" target="_blank" rel="noopener" style="color:inherit;text-decoration:none;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">RHC Solutions</a></div>
        </div>
      </a>
    </div>
    {% if session.get('user_email') %}
    <div class="sidebar-user">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="13" height="13"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
      <span>{{ session.get('user_name') or session.get('user_email') }}</span>
    </div>
    {% endif %}
    <nav class="sidebar-nav">

      <!-- ── Global ──────────────────────────────────────── -->
      <div class="nav-section">Global</div>
      <a href="{{ url_for('tenants_overview') }}" class="nav-item {% if request.endpoint == 'tenants_overview' %}active{% endif %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        <span>Tenants</span>
      </a>
      <a href="{{ url_for('wizard') }}" class="nav-item {% if request.endpoint == 'wizard' %}active{% endif %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        <span>Add Tenant</span>
      </a>

      <!-- ── Tenant tree ────────────────────────────────── -->
      {%- set _cur_slug = g.tenant_slug if g and g.tenant_slug else '' %}
      {% if g and g.all_tenants %}
        {% for _t in g.all_tenants %}
          <div class="nav-tenant-group expanded"
               id="ntg-{{ _t.slug }}">
            <div class="nav-tenant-header" onclick="toggleTenantNav('{{ _t.slug }}')">
              <span class="nav-tenant-icon">
                <!-- Zendesk-style headset / support icon -->
                <svg viewBox="0 0 24 24" width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 18v-6a9 9 0 0 1 18 0v6"/>
                  <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3z"/>
                  <path d="M3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/>
                </svg>
              </span>
              <span class="nav-tenant-name">{{ (_t.display_name or _t.slug)|truncate(20, True, '…') }}</span>
              <svg class="nav-tenant-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="11" height="11"><polyline points="6 9 12 15 18 9"/></svg>
            </div>
            <div class="nav-tenant-children">
              <a href="{{ url_for('tenant_dashboard', slug=_t.slug) }}"
                 class="nav-item nav-sub {% if request.endpoint in ('tenant_dashboard','index') and _t.slug == _cur_slug %}active{% endif %}">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                <span>Dashboard</span>
              </a>
              <a href="{{ url_for('tenant_logs', slug=_t.slug) }}"
                 class="nav-item nav-sub {% if request.endpoint in ('tenant_logs','logs') and _t.slug == _cur_slug %}active{% endif %}">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><path d="M9 12h6M9 16h4"/></svg>
                <span>Logs</span>
              </a>
              <a href="{{ url_for('tenant_settings', slug=_t.slug) }}"
                 class="nav-item nav-sub {% if request.endpoint == 'tenant_settings' and _t.slug == _cur_slug %}active{% endif %}">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/></svg>
                <span>Settings</span>
              </a>
            </div>
          </div>
        {% endfor %}
      {% endif %}

      <!-- ── System ─────────────────────────────────────── -->
      <div class="nav-divider"></div>
      <div class="nav-section">System</div>
      <a href="{{ url_for('tools') }}" class="nav-item {% if request.endpoint == 'tools' %}active{% endif %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
        <span>Tools</span>
      </a>

    </nav>
    <div class="sidebar-footer">
      <a href="{{ url_for('logout') }}" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        <span>Logout</span>
      </a>
      <button class="collapse-btn" onclick="toggleSidebar()" id="collapseBtn">
        <svg id="collapseIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><path d="m15 18-6-6 6-6"/></svg>
        <span class="collapse-label">Collapse</span>
      </button>
    </div>
  </aside>

  <!-- Main area -->
  <div class="main-area" id="mainArea">
    <header class="topbar">
      <div class="topbar-left">
        <div class="topbar-title">{% block page_title %}{% endblock %}</div>
        <div class="topbar-sub">{% block page_sub %}{% endblock %}</div>
      </div>
      <div class="topbar-actions">{% block topbar_actions %}{% endblock %}</div>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div style="padding:12px 22px 0">
      {% for category, message in messages %}
      <div class="alert alert-{{ 'danger' if category == 'error' else category }}">
        {% if category == 'success' %}<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        {% elif category in ('error','danger') %}<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        {% else %}<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><circle cx="12" cy="16" r="1" fill="currentColor" stroke="none"/></svg>{% endif %}
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    {% block full_content %}
    <div class="page-content">{% block content %}{% endblock %}</div>
    {% endblock %}
    <footer class="app-footer">
      <span>© 2026 <a href="https://rhcsolutions.com" target="_blank" rel="noopener">RHC Solutions</a>. All rights reserved.</span>
      <span class="sep">•</span>
      <a href="{{ url_for('privacy') }}">Privacy Policy</a>
      <span class="sep">•</span>
      <a href="/terms">Terms &amp; Conditions</a>
      <span class="sep">•</span>
      <a href="{{ url_for('cookies') }}">Cookies Policy</a>
    </footer>
  </div>
</div>

<div id="toastContainer"></div>

<script>
/* Global date formatter — DD-MM-YYYY HH:MM (24h) */
function _parseDate(d){if(!d)return null;if(d instanceof Date)return d;if(typeof d==='string'){/* keep tz offset as-is; only append Z if no tz info at all */var s=d.trim();if(!/Z$|[+-]\d{2}:\d{2}$/.test(s))s+='Z';var r=new Date(s);return isNaN(r.getTime())?null:r;}return null;}
function fmtDT(d){var r=_parseDate(d);if(!r)return'—';var dd=String(r.getDate()).padStart(2,'0'),mm=String(r.getMonth()+1).padStart(2,'0'),yy=r.getFullYear(),hh=String(r.getHours()).padStart(2,'0'),mi=String(r.getMinutes()).padStart(2,'0');return dd+'-'+mm+'-'+yy+' '+hh+':'+mi;}
function fmtTime(d){var r=_parseDate(d);if(!r)return'—';var hh=String(r.getHours()).padStart(2,'0'),mi=String(r.getMinutes()).padStart(2,'0'),ss=String(r.getSeconds()).padStart(2,'0');return hh+':'+mi+':'+ss;}
const CKEY = 'z2w_sb_collapsed';
const UI_STATE_VERSION_KEY = 'z2w_ui_state_version';
const UI_STATE_VERSION = '2026-02-21-2';
// One-time reset of stale UI state so new defaults are visible immediately
(function resetUiStateOnce(){
  try {
    if (localStorage.getItem(UI_STATE_VERSION_KEY) !== UI_STATE_VERSION) {
      localStorage.setItem(UI_STATE_VERSION_KEY, UI_STATE_VERSION);
      localStorage.removeItem(CKEY);
      localStorage.removeItem('z2w_tenant_nav');
      Object.keys(localStorage).forEach(function(k){ if (k.indexOf('tnav_') === 0) localStorage.removeItem(k); });
    }
  } catch(e) {}
})();
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  const ic = document.getElementById('collapseIcon');
  const c = sb.classList.toggle('collapsed');
  localStorage.setItem(CKEY, c ? '1' : '');
  ic.innerHTML = c ? '<path d="m9 18 6-6-6-6"/>' : '<path d="m15 18-6-6 6-6"/>';
}
(function(){
  if (localStorage.getItem(CKEY)) {
    document.getElementById('sidebar').classList.add('collapsed');
    document.getElementById('collapseIcon').innerHTML = '<path d="m9 18 6-6-6-6"/>';
  }
})();

function showToast(message, type) {
  type = type || 'success';
  const bg = {
    success: 'oklch(0.46 0.14 162)',
    danger:  'oklch(0.48 0.22 27)',
    warning: 'oklch(0.52 0.16 70)',
    info:    'oklch(0.46 0.13 221.7)',
    secondary: 'oklch(0.38 0.008 265)'
  };
  const id = 'toast-' + Date.now();
  const el = document.createElement('div');
  el.id = id; el.className = 'toast'; el.style.background = bg[type] || bg.secondary;
  el.innerHTML = '<span style="flex:1">' + message + '</span><button class="toast-close" onclick="document.getElementById(\'' + id + '\').remove()">&#215;</button>';
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(() => { const t = document.getElementById(id); if(t) t.remove(); }, 7000);
}

function openModal(id)  { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.addEventListener('click', e => { if (e.target.classList.contains('modal-overlay')) e.target.classList.remove('open'); });

/* ── Tenant nav: toggle, persist, auto-expand on first visit ── */
function toggleTenantNav(slug) {
  var grp = document.getElementById('ntg-' + slug);
  if (!grp) return;
  grp.classList.toggle('expanded');
  _saveTenantNavState();
}
function _saveTenantNavState() {
  var state = {};
  document.querySelectorAll('[id^="ntg-"]').forEach(function(g) {
    state[g.id] = g.classList.contains('expanded');
  });
  try { localStorage.setItem('z2w_tenant_nav', JSON.stringify(state)); } catch(e) {}
}
(function _restoreTenantNavState() {
  var raw;
  try { raw = localStorage.getItem('z2w_tenant_nav'); } catch(e) {}
  if (raw) {
    try {
      var state = JSON.parse(raw);
      document.querySelectorAll('[id^="ntg-"]').forEach(function(g) {
        if (state[g.id] === false) g.classList.remove('expanded');
        else g.classList.add('expanded');
      });
      return;
    } catch(e) {}
  }
  /* First visit — expand all */
  document.querySelectorAll('[id^="ntg-"]').forEach(function(g) {
    g.classList.add('expanded');
  });
})();
</script>
{% block scripts %}{% endblock %}
</body>
</html>