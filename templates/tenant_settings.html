{% extends "base.html" %}

{% block page_title %}{{ cfg.display_name }} — Settings{% endblock %}
{% block page_sub %}{{ cfg.slug }}.zendesk.com{% endblock %}

{% block topbar_actions %}
<a href="{{ url_for('tenant_dashboard', slug=cfg.slug) }}"
   style="font-size:.8rem;color:#888;text-decoration:none;display:flex;align-items:center;gap:4px;">
  ← Dashboard
</a>
{% endblock %}

{% block content %}
<style>
.ts-wrap { max-width: 780px; margin: 1.5rem auto; padding: 0 1.5rem; display: flex; flex-direction: column; gap: 1.5rem; }

.ts-card {
  background: var(--card-bg, #1a1a2e);
  border: 1px solid var(--border, #2a2a3e);
  border-radius: 11px;
  overflow: hidden;
}
.ts-card-header {
  padding: .85rem 1.25rem .7rem;
  border-bottom: 1px solid var(--border, #2a2a3e);
  display: flex; align-items: center; gap: .6rem;
}
.ts-card-header svg { width: 16px; height: 16px; color: var(--accent, #6c63ff); flex-shrink: 0; }
.ts-card-header h3 { margin: 0; font-size: .9rem; font-weight: 600; color: var(--text-primary, #e0e0e0); }

.ts-body { padding: 1.25rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
.ts-body.single-col { grid-template-columns: 1fr; }

.form-row { display: flex; flex-direction: column; gap: .3rem; }
.form-row label { font-size: .75rem; color: #aaa; font-weight: 600; }
.form-row input, .form-row select {
  background: var(--input-bg, #12121e);
  border: 1px solid var(--border, #2a2a3e);
  border-radius: 6px;
  color: var(--text-primary, #e0e0e0);
  font-size: .85rem;
  padding: .42rem .65rem;
  outline: none;
  transition: border-color .15s;
}
.form-row input:focus, .form-row select:focus { border-color: var(--accent, #6c63ff); }
.form-row .hint { font-size: .7rem; color: #666; }

.ts-footer { padding: .9rem 1.25rem; border-top: 1px solid var(--border, #2a2a3e); display: flex; gap: .75rem; }
.btn-save { padding: .44rem 1.1rem; background: var(--accent, #6c63ff); color: #fff; border: none; border-radius: 7px; font-size: .85rem; font-weight: 600; cursor: pointer; }
.btn-save:hover { opacity: .85; }
.check-row { display: flex; align-items: center; gap: .5rem; font-size: .82rem; color: #ccc; }
.check-row input[type=checkbox] { accent-color: var(--accent, #6c63ff); width: 15px; height: 15px; }
</style>

<form method="POST" action="{{ url_for('tenant_settings', slug=cfg.slug) }}">
<div class="ts-wrap">

  <!-- General -->
  <div class="ts-card">
    <div class="ts-card-header">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/></svg>
      <h3>General</h3>
    </div>
    <div class="ts-body single-col">
      <div class="form-row">
        <label>Display Name</label>
        <input name="display_name" value="{{ cfg.display_name }}">
      </div>
    </div>
  </div>

  <!-- Zendesk -->
  <div class="ts-card">
    <div class="ts-card-header">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg>
      <h3>Zendesk</h3>
    </div>
    <div class="ts-body">
      <div class="form-row">
        <label>Subdomain</label>
        <input name="zendesk_subdomain" value="{{ cfg.zendesk_subdomain }}">
        <div class="hint">{{ cfg.zendesk_subdomain }}.zendesk.com</div>
      </div>
      <div class="form-row">
        <label>Admin Email</label>
        <input name="zendesk_email" type="email" value="{{ cfg.zendesk_email }}">
      </div>
      <div class="form-row" style="grid-column:1/-1">
        <label>API Token</label>
        <input name="zendesk_api_token" type="password" value="{{ cfg.zendesk_api_token }}"
               placeholder="(unchanged if empty)">
      </div>
    </div>
  </div>

  <!-- Wasabi Offload -->
  <div class="ts-card">
    <div class="ts-card-header">
      <!-- Wasabi brand mark -->
      <svg viewBox="0 0 32 32" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="16" fill="#4CAF50"/>
        <path d="M7 10.5 L11.5 21.5 L16 13 L20.5 21.5 L25 10.5" stroke="#fff" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
      <h3>Wasabi &mdash; Offload Bucket</h3>
    </div>
    <div class="ts-body">
      <div class="form-row">
        <label>Endpoint</label>
        <input name="wasabi_endpoint" value="{{ cfg.wasabi_endpoint }}">
      </div>
      <div class="form-row">
        <label>Bucket Name</label>
        <input name="wasabi_bucket_name" value="{{ cfg.wasabi_bucket_name }}">
      </div>
      <div class="form-row">
        <label>Access Key</label>
        <input name="wasabi_access_key" value="{{ cfg.wasabi_access_key }}">
      </div>
      <div class="form-row">
        <label>Secret Key</label>
        <input name="wasabi_secret_key" type="password" value="{{ cfg.wasabi_secret_key }}"
               placeholder="(unchanged if empty)">
      </div>
    </div>
  </div>

  <!-- Wasabi Backup -->
  <div class="ts-card">
    <div class="ts-card-header">
      <!-- Wasabi brand mark -->
      <svg viewBox="0 0 32 32" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="16" fill="#4CAF50"/>
        <path d="M7 10.5 L11.5 21.5 L16 13 L20.5 21.5 L25 10.5" stroke="#fff" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
      <h3>Wasabi &mdash; Backup Bucket</h3>
    </div>
    <div class="ts-body">
      <div class="form-row">
        <label>Endpoint</label>
        <input name="ticket_backup_endpoint" value="{{ cfg.ticket_backup_endpoint }}">
      </div>
      <div class="form-row">
        <label>Bucket Name</label>
        <input name="ticket_backup_bucket" value="{{ cfg.ticket_backup_bucket }}">
      </div>
    </div>
  </div>

  <!-- Telegram -->
  <div class="ts-card">
    <div class="ts-card-header">
      <!-- Telegram logo -->
      <svg viewBox="0 0 32 32" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="16" fill="#29B6F6"/>
        <path d="M6.5 15.8 L25.5 8.5 L20.5 24 L15 18.5 L22 12 L13 17.5 Z" fill="#fff"/>
        <path d="M13 17.5 L15 23 L17 19.5" fill="#E1F5FE"/>
      </svg>
      <h3>Telegram</h3>
    </div>
    <div class="ts-body">
      <div class="form-row">
        <label>Bot Token</label>
        <input name="telegram_bot_token" type="password" value="{{ cfg.telegram_bot_token }}"
               placeholder="(unchanged if empty)">
      </div>
      <div class="form-row">
        <label>Chat ID</label>
        <input name="telegram_chat_id" value="{{ cfg.telegram_chat_id }}">
      </div>
    </div>
  </div>

  <!-- Slack -->
  <div class="ts-card">
    <div class="ts-card-header">
      <!-- Slack logo -->
      <svg viewBox="0 0 32 32" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="16" fill="#4A154B"/>
        <path d="M12 9a2 2 0 1 0 0 4h2V9h-2z" fill="#E01E5A"/>
        <path d="M9 12a2 2 0 1 0 4 0v-2H9v2z" fill="#E01E5A"/>
        <path d="M14 12h6" stroke="#E01E5A" stroke-width="2"/>
        <path d="M20 9a2 2 0 1 0 0 4h-2V9h2z" fill="#ECB22E"/>
        <path d="M23 12a2 2 0 1 0-4 0v2h4v-2z" fill="#ECB22E"/>
        <path d="M12 14v6" stroke="#2EB67D" stroke-width="2"/>
        <path d="M12 20a2 2 0 1 0 4 0v-2h-4v2z" fill="#2EB67D"/>
        <path d="M9 20a2 2 0 1 0 0-4h2v4H9z" fill="#2EB67D"/>
        <path d="M20 14a2 2 0 1 0-4 0v2h4v-2z" fill="#36C5F0"/>
        <path d="M23 20a2 2 0 1 0 0-4h-2v4h2z" fill="#36C5F0"/>
        <path d="M20 18h-6" stroke="#36C5F0" stroke-width="2"/>
      </svg>
      <h3>Slack</h3>
    </div>
    <div class="ts-body single-col">
      <div class="form-row">
        <label>Webhook URL</label>
        <input name="slack_webhook_url" value="{{ cfg.slack_webhook_url }}" placeholder="https://hooks.slack.com/services/...">
      </div>
    </div>
  </div>

  <!-- Scheduler -->
  <div class="ts-card">
    <div class="ts-card-header">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      <h3>Scheduler</h3>
    </div>
    <div class="ts-body">
      <div class="form-row">
        <label>Timezone</label>
        <input name="scheduler_timezone" value="{{ cfg.scheduler_timezone }}">
      </div>
      <div class="form-row">
        <label>Continuous Offload Interval (min)</label>
        <input name="continuous_offload_interval" type="number" value="{{ cfg.continuous_offload_interval }}">
      </div>
      <div class="form-row">
        <label>Ticket Backup Time (HH:MM)</label>
        <input name="ticket_backup_time" value="{{ cfg.ticket_backup_time }}">
      </div>
      <div class="form-row">
        <label>Backup Max Per Run (0=unlimited)</label>
        <input name="ticket_backup_max_per_run" type="number" value="{{ cfg.ticket_backup_max_per_run }}">
      </div>
      <div class="form-row">
        <label>Max Attachments Per Run (0=unlimited)</label>
        <input name="max_attachments_per_run" type="number" value="{{ cfg.max_attachments_per_run }}">
      </div>
      <div class="form-row">
        <label>Storage Report Interval (min)</label>
        <input name="storage_report_interval" type="number" value="{{ cfg.storage_report_interval }}">
      </div>
      <div class="form-row" style="grid-column:1/-1">
        <label class="check-row">
          <input type="checkbox" name="attach_offload_enabled" {% if cfg.attach_offload_enabled %}checked{% endif %}>
          Attachment offload enabled
        </label>
        <label class="check-row" style="margin-top:.4rem">
          <input type="checkbox" name="ticket_backup_enabled" {% if cfg.ticket_backup_enabled %}checked{% endif %}>
          Ticket backup enabled
        </label>
      </div>
    </div>
    <div class="ts-footer">
      <button type="submit" class="btn-save">Save Settings</button>
    </div>
  </div>

  <!-- Alerts -->
  <div class="ts-card">
    <div class="ts-card-header">
      <!-- Bell icon -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      <h3>Alerts &amp; Notifications</h3>
    </div>
    <div class="ts-body" style="grid-template-columns:1fr;">

      <div style="font-size:.72rem;color:#888;font-weight:600;text-transform:uppercase;letter-spacing:.05em;padding-bottom:.3rem;border-bottom:1px solid var(--border,.2a2a3e);margin-bottom:.2rem;">Immediate Alerts (on failure)</div>
      <label class="check-row">
        <input type="checkbox" name="alert_on_offload_error" {% if cfg.alert_on_offload_error %}checked{% endif %}>
        Send alert when offload job crashes
      </label>
      <label class="check-row" style="margin-top:.4rem">
        <input type="checkbox" name="alert_on_backup_error" {% if cfg.alert_on_backup_error %}checked{% endif %}>
        Send alert when backup job crashes
      </label>

      <div style="font-size:.72rem;color:#888;font-weight:600;text-transform:uppercase;letter-spacing:.05em;padding-bottom:.3rem;border-bottom:1px solid var(--border,.2a2a3e);margin-top:1rem;margin-bottom:.2rem;">Daily Report (sent at 00:01)</div>
      <label class="check-row">
        <input type="checkbox" name="alert_daily_report" {% if cfg.alert_daily_report %}checked{% endif %}>
        Enable daily summary report
      </label>
      <label class="check-row" style="margin-top:.4rem;padding-left:1.2rem;">
        <input type="checkbox" name="alert_daily_telegram" {% if cfg.alert_daily_telegram %}checked{% endif %}>
        Send via Telegram
      </label>
      <label class="check-row" style="margin-top:.4rem;padding-left:1.2rem;">
        <input type="checkbox" name="alert_daily_slack" {% if cfg.alert_daily_slack %}checked{% endif %}>
        Send via Slack
      </label>

      <div style="font-size:.72rem;color:#888;font-weight:600;text-transform:uppercase;letter-spacing:.05em;padding-bottom:.3rem;border-bottom:1px solid var(--border,.2a2a3e);margin-top:1rem;margin-bottom:.2rem;">Daily Report Content</div>
      <label class="check-row">
        <input type="checkbox" name="alert_include_offload_stats" {% if cfg.alert_include_offload_stats %}checked{% endif %}>
        Include attachment offload statistics
      </label>
      <label class="check-row" style="margin-top:.4rem">
        <input type="checkbox" name="alert_include_backup_stats" {% if cfg.alert_include_backup_stats %}checked{% endif %}>
        Include closed-ticket backup statistics
      </label>
      <label class="check-row" style="margin-top:.4rem">
        <input type="checkbox" name="alert_include_errors_detail" {% if cfg.alert_include_errors_detail %}checked{% endif %}>
        Include error detail lines when errors &gt; 0
      </label>

    </div>
    <div class="ts-footer">
      <button type="submit" class="btn-save">Save Settings</button>
    </div>
  </div>

</div>
</form>
{% endblock %}
